<html>
	<head>
		<title>Team 8</title>

		<script src="/socket.io/socket.io.js"></script>
		<script src="/chartist.min.js" ></script>
		<script src="/chartist-plugin-axistitle.min.js" ></script>
		<!-- <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script> -->
		<script src="/jquery-1.11.3.min.js"></script>
		<link rel="stylesheet" href="/chartist.min.css">

		<script>
			var phChart;
			var phChartData = {
				labels: [],
				series: [[]]
			};
			var temperatureChart;
			var temperatureChartData = {
				labels: [],
				series: [[]]
			};
			var stirringSpeedChart;
			var stirringSpeedChartData = {
				labels: [],
				series: [[]]
			};

			$(function() {
				connectToWebSocket();
				phChart = new Chartist.Line('#chart1', phChartData, createChartOptions("pH"));
				temperatureChart = new Chartist.Line('#chart2', temperatureChartData, createChartOptions("Temperature (Â°C)"));
				stirringSpeedChart = new Chartist.Line('#chart3', stirringSpeedChartData, createChartOptions("Stirring speed"));

				$("#phForm").on('submit', function(event) {
					event.preventDefault();
					$.get("setph/" + $("#phForm [name='setpoint']")[0].value, function(data) {
						console.log(data);

					});
				});
				$("#speedForm").submit(function(event) {
					event.preventDefault();
					$.get("setspeed/" + $("#speedForm [name='setpoint']")[0].value, function(data) {
						console.log(data);
						console.log()
					});
				});
				$("#temperatureForm").submit(function(event) {
					event.preventDefault();
					$.get("settemperature=" + $("#temperatureForm [name='setpoint']")[0].value, function(data) {
						console.log(data);
					});
				});
			});

			function connectToWebSocket() {
				var socket = io.connect();
				socket.on('update', function(msg) {
					updateCharts(msg.data);
				});
			}

			/**
			 * Updates the datasets behind charts, causing a complete re-render of the SVG
			 */
			function updateCharts(data) {
				var date = new Date();
				var dateString = date.getSeconds();
				var dataset = data.split(" ");
				if (temperatureChartData.labels.length > 10) {
					temperatureChartData.labels.splice(0, 1);
					temperatureChartData.series[0].splice(0, 1);
				}
				temperatureChartData.labels.push(dateString);
				temperatureChartData.series[0].push(3);
				temperatureChart.update(temperatureChartData);
			}

			function createChartOptions(yAxisTitle) {
				return {
					plugins: [
						Chartist.plugins.ctAxisTitle({
							axisX: {
								axisTitle: 'Time',
								axisClass: 'ct-axis-title',
								offset: {
									x: 0,
									y: 40
								},
								textAnchor: 'middle'
							},
							axisY: {
								axisTitle: yAxisTitle,
								axisClass: 'ct-axis-title',
								offset: {
									x: 0,
									y: 5
								},
								textAnchor: 'middle',
								flipTitle: true
							}
						})
					]
				};
			}
		</script>

		<style>
			body {
				margin: 0;
			}
			.ct-chart svg {
				overflow: visible;
				padding-left: 15px;
				width: calc(100% - 15px) !important;
			}
			h1, h2, h3, h4, h5, h6, p, li {
				font-family: 'Dosis', sans-serif;
			}
			.header {
				text-align: center;
			    background: #F0EEE5;
			    overflow: hidden;
				border-bottom: 1px solid #E4DDC4;
			}
			a {
				text-decoration: none;
				color: brown;
			}
			.container {
				max-width: 600px;
				margin: 0 auto 80px auto;
			}
			.footer {
				height: 100px;
				background: #F0EEE5;
				border-top: 1px solid #E4DDC4;
				padding-left: 30px;
			}
			ul {

			}
			li {
				display: block;
			    float: left;
			    height: auto;
			    list-style: none;
			    width: 33.33333333%;
			}
		</style>
	</head>

	<body>
		<div class="header">
			<h1>Team 8!</h1>
			<ul>
				<li>
					<div class="chart">
						<div class="ct-chart ct-golden-section" style="margin-bottom: 40px;" id="chart1"></div>
					</div>
					<form id="phForm" action="setph">
						Desired PH: <input type="number" name="setpoint" value="">
						<input type="submit" value="Submit">
					</form>
				</li>

				<li>
					<div class="chart">
						<div class="ct-chart ct-golden-section" id="chart2"></div>
					</div>
					<form id="temperatureForm" action="settemperature">
						Desired Temperature: <input type="number" name="setpoint" value="">
					  <input type="submit" value="Submit">
					</form>
				</li>

				<li>
					<div class="chart">
						<div class="ct-chart ct-golden-section" id="chart3"></div>
					</div>
					<form id="speedForm" action="setspeed">
					  Desired Speed: <input type="number" name="setpoint" value="">
					  <input type="submit" value="Submit">
					</form>
				</li>
			</ul>
		</div>
		<div class="footer">
		</div>
	</body>
</html>
